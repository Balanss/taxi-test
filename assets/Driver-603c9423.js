import{j as c,r as s,c as a,T as l,b as m,A as d,d as i,K as f,Q as A,a as g,f as T,G as k}from"./index-dc51c0e8.js";import{u as L,G as M,N as ce}from"./Navbar-73b17090.js";import"./cjs-c1300a82.js";function re(){const{isLoaded:r}=L({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),u={lat:5.839398,lng:-55.199089};if(!r)return c("div",{children:" loading .... "});if(r)return c("div",{className:"",children:c(M,{zoom:12,center:u,mapContainerClassName:"admin-map "})})}function fe({lat:r,lon:u}){return a("p",{children:[" ",r," ",u," "]})}function he(){const[r,u]=s.exports.useState([]);s.exports.useState(""),s.exports.useState("");const[x,W]=s.exports.useState(""),[v,G]=s.exports.useState("");s.exports.useState([]);const[I,F]=s.exports.useState([]),[S,le]=s.exports.useState(""),[p,h]=s.exports.useState(null),[de,j]=s.exports.useState([]),[U,z]=s.exports.useState(""),[P,B]=s.exports.useState("none");s.exports.useState();const[K,Q]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const e=l(i,"place");m(e,n=>{Q(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=l(i,"drivers");m(e,n=>{u(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=l(i,"driver");m(e,n=>{F(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=l(i,"rider");m(e,n=>{j(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const{isLoaded:b}=L({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),_={lat:5.839398,lng:-55.199089};function C(){var t,e;t=new google.maps.Map(document.getElementById("map"),{center:{lat:5.839398,lng:-55.199089},zoom:18}),e=new google.maps.InfoWindow,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var o={lat:n.coords.latitude,lng:n.coords.longitude};e.setPosition(o),e.setContent(S),e.open(t),t.setCenter(o),W(n.coords.latitude),G(n.coords.longitude)},function(){N(!0,e,t.getCenter())}):N(!1,e,t.getCenter())}function N(t,e){infoWindow.setPosition(e),infoWindow.setContent(t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),infoWindow.open(re)}window.initMap=C;const[y,O]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const e=l(i,"client");m(e,n=>{O(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const Y=()=>r.map((t,e)=>t.toDriver===p?a("div",{children:[a("h4",{children:[" Client Name: ",t.name," "]}),a("h4",{children:[" number: ",t.number]}),a("h4",{children:[" From : ",t.To," "]}),a("h4",{children:[" To : ",t.pickup," "]}),a("h4",{children:[" Distance : ",t.distance]}),a("h4",{children:[" Avg Duration : ",t.duration]}),a("h4",{children:[" Ride Status : ",t.status]}),a("h4",{children:[" Driver : ",t.toDriver," "]}),a("h4",{onClick:()=>{z(t.id)},children:[" ","id : ",t.id," "]})]},e):null),q=()=>y.map((t,e)=>{if(p===D)return a("div",{className:"button-css",children:[a("h4",{children:[" Client Status : ",t.client]}),a("button",{className:"button",onClick:()=>{const n=d(i,"client",t.id);f(n,{client:"client pickedup"})},children:[" ","client pickup"]})]},e)});function H(){return(()=>I.map((e,n)=>{const o=d(i,"driver",e.id);f(o,{statusDispatch:"accepted"})}))()}function J(){return(()=>K.map((e,n)=>{const o=d(i,"place",e.id);f(o,{lat:x,lng:v})}))()}function V(){const t=l(i,"place");A(t,{lat:x,lng:v,number:S})}const[D,X]=s.exports.useState(),[Z,$]=s.exports.useState();function ee(){return(()=>r.map((e,n)=>{X(p),$(e.client);const o=d(i,"drivers",e.id);f(o,{status:"accepted"});const ie=l(i,"client");Z===e.client&&A(ie,{client:"driver underway",number:Number(p),clientId:e.client})}))()}console.log(D);function te(){return(()=>r.map((e,n)=>{k(d(i,"drivers",U)),h(0)}))()}function ne(){return(()=>y.map((e,n)=>{k(d(i,"client",e.id)),h(0)}))()}function oe(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{g.onAuthStateChanged(n=>{n&&e(n.uid)})},[]),t}oe();function se(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{g.onAuthStateChanged(n=>{n?T.collection("rider").doc(n.uid).get().then(o=>{e(o.data().FullName),h(o.data().Number)}):e(null)})},[]),t}const R=se();function ae(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{g.onAuthStateChanged(n=>{n?T.collection("manager").doc(n.uid).get().then(o=>{e(o.data().FullName)}):e(null)})},[]),t}const w=ae();return b?b&&w||p||R?a("div",{className:"",children:[c(ce,{riders:R,manager:w}),a("div",{className:"whole-driver-div",children:[a("div",{className:"driver-view",children:[a("button",{id:"button",className:"map-btn button",onClick:()=>{setInterval(()=>{C(),B("block")},3e4),setTimeout(()=>{V()},11e3)},children:[" ","Open For Ride"," "]}),a("button",{style:{display:P},className:"button",onClick:()=>setInterval(()=>{J()},9e3),children:[" ","Send to Dispatch"," "]}),c(Y,{})," ",a("button",{className:"button",onClick:()=>{ee(),H()},children:[" ","Accept Ride"," "]}),a("button",{className:"button",onClick:()=>{te(),ne()},children:[" ","Remove Ride"," "]}),c(q,{})]}),c("div",{className:"map-view-driver",children:c(M,{id:"map",className:"",zoom:12,center:_,mapContainerClassName:"admin-map driver-map"})})]})]}):null:c("div",{children:" loading .... "})}export{fe as State,he as default};
