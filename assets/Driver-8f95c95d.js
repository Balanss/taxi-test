import{j as c,r as s,c as a,T as d,b as m,A as l,K as f,d as i,a as S,f as A,Q as ie,G as T}from"./index-f619bc13.js";import{u as k,G as L,N as ce}from"./Navbar-6a299836.js";import"./cjs-3134eb97.js";function re(){const{isLoaded:r}=k({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),u={lat:5.839398,lng:-55.199089};if(!r)return c("div",{children:" loading .... "});if(r)return c("div",{className:"",children:c(L,{zoom:12,center:u,mapContainerClassName:"admin-map "})})}function he({lat:r,lon:u}){return a("p",{children:[" ",r," ",u," "]})}function ge(){const[r,u]=s.exports.useState([]);s.exports.useState(""),s.exports.useState("");const[g,M]=s.exports.useState(""),[x,G]=s.exports.useState("");s.exports.useState([]);const[I,W]=s.exports.useState([]),[F,le]=s.exports.useState(""),[p,v]=s.exports.useState(null),[de,j]=s.exports.useState([]),[U,z]=s.exports.useState(""),[ue,K]=s.exports.useState("none");s.exports.useState();const[b,P]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const e=d(i,"place");m(e,n=>{P(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=d(i,"drivers");m(e,n=>{u(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=d(i,"driver");m(e,n=>{W(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=d(i,"rider");m(e,n=>{j(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const{isLoaded:C}=k({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),B={lat:5.839398,lng:-55.199089};function N(){var t,e;t=new google.maps.Map(document.getElementById("map"),{center:{lat:5.839398,lng:-55.199089},zoom:18}),e=new google.maps.InfoWindow,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var o={lat:n.coords.latitude,lng:n.coords.longitude};e.setPosition(o),e.setContent(F),e.open(t),t.setCenter(o),M(n.coords.latitude),G(n.coords.longitude),b.map((h,E)=>{const se=l(i,"place","wNY5vHqvIZAsDKAGvYie"),ae={lat:n.coords.latitude,lng:n.coords.longitude};f(se,ae),console.log(h.id)})},function(){D(!0,e,t.getCenter())}):D(!1,e,t.getCenter())}function D(t,e){infoWindow.setPosition(e),infoWindow.setContent(t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),infoWindow.open(re)}window.initMap=N;const[y,Q]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const e=d(i,"client");m(e,n=>{Q(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const _=()=>r.map((t,e)=>t.toDriver===p?a("div",{children:[a("h4",{children:[" Client Name: ",t.name," "]}),a("h4",{children:[" number: ",t.number]}),a("h4",{children:[" From : ",t.To," "]}),a("h4",{children:[" To : ",t.pickup," "]}),a("h4",{children:[" Distance : ",t.distance]}),a("h4",{children:[" Avg Duration : ",t.duration]}),a("h4",{children:[" Ride Status : ",t.status]}),a("h4",{children:[" Driver : ",t.toDriver," "]}),a("h4",{onClick:()=>{z(t.id)},children:[" ","id : ",t.id," "]})]},e):null),O=()=>y.map((t,e)=>{if(p===H)return a("div",{className:"button-css",children:[a("h4",{children:[" Client Status : ",t.client]}),a("button",{className:"button",onClick:()=>{const n=l(i,"client",t.id);f(n,{client:"client pickedup"})},children:[" ","client pickup"]})]},e)});function Y(){return(()=>I.map((e,n)=>{const o=l(i,"driver",e.id);f(o,{statusDispatch:"accepted"})}))()}function q(){return(()=>{b.map((e,n)=>{const o=l(i,"place",e.id);f(o,{lat:g,lng:x}),console.log(e.id)})})()}console.log(g,x);const[H,Z]=s.exports.useState(),[J,V]=s.exports.useState();function X(){return(()=>r.map((e,n)=>{Z(p),V(e.client);const o=l(i,"drivers",e.id);f(o,{status:"accepted"});const E=d(i,"client");J===e.client&&ie(E,{client:"driver underway",number:Number(p),clientId:e.client})}))()}function $(){return(()=>r.map((e,n)=>{T(l(i,"drivers",U)),v(0)}))()}function ee(){return(()=>y.map((e,n)=>{T(l(i,"client",e.id)),v(0)}))()}function te(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{S.onAuthStateChanged(n=>{n&&e(n.uid)})},[]),t}te();function ne(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{S.onAuthStateChanged(n=>{n?A.collection("rider").doc(n.uid).get().then(o=>{e(o.data().FullName),v(o.data().Number)}):e(null)})},[]),t}const w=ne();function oe(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{S.onAuthStateChanged(n=>{n?A.collection("manager").doc(n.uid).get().then(o=>{e(o.data().FullName)}):e(null)})},[]),t}const R=oe();return C?C&&R||p||w?a("div",{className:"",children:[c(ce,{riders:w,manager:R}),a("div",{className:"whole-driver-div",children:[a("div",{className:"driver-view",children:[a("button",{id:"button",className:"map-btn button",onClick:()=>{setInterval(()=>{N(),K("block")},3e4),setTimeout(()=>{},9e3)},children:[" ","Open For Ride"," "]}),a("button",{className:"button",onClick:()=>{setInterval(()=>{q()},9e3)},children:[" ","Send to Dispatch"," "]}),a("p",{children:[" ",g," , ",x,"  "]}),c(_,{})," ",a("button",{className:"button",onClick:()=>{X(),Y()},children:[" ","Accept Ride"," "]}),a("button",{className:"button",onClick:()=>{$(),ee()},children:[" ","Remove Ride"," "]}),c(O,{})]}),c("div",{className:"map-view-driver",children:c(L,{id:"map",className:"",zoom:12,center:B,mapContainerClassName:"admin-map driver-map"})})]})]}):null:c("div",{children:" loading .... "})}export{he as State,ge as default};
