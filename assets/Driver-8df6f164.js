import{j as c,r as s,c as a,T as l,b as f,A as u,d as i,K as m,Q as w,a as g,f as E,G as k}from"./index-c166a26e.js";import{u as A,G as T,N as oe}from"./Navbar-b1695df9.js";import"./cjs-fe7c74b5.js";function se(){const{isLoaded:r}=A({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),p={lat:5.839398,lng:-55.199089};if(!r)return c("div",{children:" loading .... "});if(r)return c("div",{className:"",children:c(T,{zoom:12,center:p,mapContainerClassName:"admin-map "})})}function ue({lat:r,lon:p}){return a("p",{children:[" ",r," ",p," "]})}function pe(){const[r,p]=s.exports.useState([]);s.exports.useState(""),s.exports.useState("");const[v,L]=s.exports.useState(""),[x,W]=s.exports.useState("");s.exports.useState([]);const[G,M]=s.exports.useState([]),[d,ae]=s.exports.useState(""),[ie,h]=s.exports.useState(null),[ce,F]=s.exports.useState([]),[I,j]=s.exports.useState(""),[U,z]=s.exports.useState("none"),[P,B]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const t=l(i,"place");f(t,n=>{B(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const t=l(i,"drivers");f(t,n=>{p(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const t=l(i,"driver");f(t,n=>{M(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const t=l(i,"rider");f(t,n=>{F(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const{isLoaded:C}=A({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),K={lat:5.839398,lng:-55.199089};function b(){var e,t;e=new google.maps.Map(document.getElementById("map"),{center:{lat:5.839398,lng:-55.199089},zoom:18}),t=new google.maps.InfoWindow,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var o={lat:n.coords.latitude,lng:n.coords.longitude};t.setPosition(o),t.setContent(d),t.open(e),e.setCenter(o),L(n.coords.latitude),W(n.coords.longitude)},function(){S(!0,t,e.getCenter())}):S(!1,t,e.getCenter())}function S(e,t){infoWindow.setPosition(t),infoWindow.setContent(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),infoWindow.open(se)}window.initMap=b;const[D,Q]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const t=l(i,"client");f(t,n=>{Q(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const _=()=>r.map((e,t)=>e.toDriver===d?a("div",{children:[a("h4",{children:[" Client Name: ",e.name," "]}),a("h4",{children:[" number: ",e.number]}),a("h4",{children:[" From : ",e.To," "]}),a("h4",{children:[" To : ",e.pickup," "]}),a("h4",{children:[" Distance : ",e.distance]}),a("h4",{children:[" Avg Duration : ",e.duration]}),a("h4",{children:[" Ride Status : ",e.status]}),a("h4",{children:[" Driver : ",e.toDriver," "]}),a("h4",{onClick:()=>{j(e.id)},children:[" ","id : ",e.id," "]})]},t):null),O=()=>r.map((e,t)=>{if(d===e.toDriver)return c("button",{onClick:()=>{h(e.toDriver)},children:e.toDriver},t)}),Y=()=>D.map((e,t)=>{if(d===e.number)return a("div",{className:"button-css",children:[a("h4",{children:[" Client Status : ",e.client]}),a("button",{className:"button",onClick:()=>{const n=u(i,"client",e.id);m(n,{client:"client pickedup"})},children:[" ","client pickup"]})]},t)});function q(){return(()=>G.map((t,n)=>{const o=u(i,"driver",t.id);m(o,{statusDispatch:"accepted"})}))()}function H(){return(()=>P.map((t,n)=>{const o=u(i,"place",t.id);m(o,{lat:v,lng:x})}))()}function J(){const e=l(i,"place");w(e,{lat:v,lng:x,number:d})}function V(){return(()=>r.map((t,n)=>{const o=u(i,"drivers",t.id);m(o,{status:"accepted"});const ne=l(i,"client");w(ne,{client:"driver underway",number:Number(d)})}))()}function X(){return(()=>r.map((t,n)=>{k(u(i,"drivers",I)),h(0)}))()}function Z(){return(()=>D.map((t,n)=>{k(u(i,"client",t.id)),h(0)}))()}function $(){const[e,t]=s.exports.useState(null);return s.exports.useEffect(()=>{g.onAuthStateChanged(n=>{n&&t(n.uid)})},[]),e}$();function ee(){const[e,t]=s.exports.useState(null);return s.exports.useEffect(()=>{g.onAuthStateChanged(n=>{n?E.collection("rider").doc(n.uid).get().then(o=>{t(o.data().FullName)}):t(null)})},[]),e}const N=ee();function te(){const[e,t]=s.exports.useState(null);return s.exports.useEffect(()=>{g.onAuthStateChanged(n=>{n?E.collection("manager").doc(n.uid).get().then(o=>{t(o.data().FullName)}):t(null)})},[]),e}const y=te();return C?C&&y||N?a("div",{className:"",children:[c(oe,{riders:N,manager:y}),c(O,{}),a("div",{className:"whole-driver-div",children:[a("div",{className:"driver-view",children:[a("button",{id:"button",className:"map-btn button",onClick:()=>{setInterval(()=>{b(),z("block")},3e4),setTimeout(()=>{J()},11e3)},children:[" ","Open For Ride"," "]}),a("button",{style:{display:U},className:"button",onClick:()=>setInterval(()=>{H()},9e3),children:[" ","Send to Dispatch"," "]}),c(_,{})," ",a("button",{className:"button",onClick:()=>{V(),q()},children:[" ","Accept Ride"," "]}),a("button",{className:"button",onClick:()=>{X(),Z()},children:[" ","Remove Ride"," "]}),c(Y,{})]}),c("div",{className:"map-view-driver",children:c(T,{id:"map",className:"",zoom:12,center:K,mapContainerClassName:"admin-map driver-map"})})]})]}):null:c("div",{children:" loading .... "})}export{ue as State,pe as default};
