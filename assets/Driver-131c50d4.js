import{j as c,r as s,c as a,T as l,b as f,Q as S,A as u,d as i,K as x,a as b,f as A,G as T}from"./index-cf0e6825.js";import{u as k,G as L,N as ie}from"./Navbar-9e36a35b.js";import"./cjs-e269a208.js";function ce(){const{isLoaded:r}=k({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),p={lat:5.839398,lng:-55.199089};if(!r)return c("div",{children:" loading .... "});if(r)return c("div",{className:"",children:c(L,{zoom:12,center:p,mapContainerClassName:"admin-map "})})}function me({lat:r,lon:p}){return a("p",{children:[" ",r," ",p," "]})}function he(){const[r,p]=s.exports.useState([]);s.exports.useState(""),s.exports.useState("");const[m,M]=s.exports.useState(""),[h,I]=s.exports.useState("");s.exports.useState([]);const[W,G]=s.exports.useState([]),[C,re]=s.exports.useState(""),[d,v]=s.exports.useState(null),[le,F]=s.exports.useState([]),[j,U]=s.exports.useState(""),[de,z]=s.exports.useState("none");s.exports.useState();const[P,B]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const e=l(i,"place");f(e,n=>{B(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=l(i,"drivers");f(e,n=>{p(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=l(i,"driver");f(e,n=>{G(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]),s.exports.useEffect(()=>{(async()=>{const e=l(i,"rider");f(e,n=>{F(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const{isLoaded:N}=k({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),K={lat:5.839398,lng:-55.199089};function D(){var t,e;t=new google.maps.Map(document.getElementById("map"),{center:{lat:5.839398,lng:-55.199089},zoom:18}),e=new google.maps.InfoWindow,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var o={lat:n.coords.latitude,lng:n.coords.longitude};e.setPosition(o),e.setContent(C),e.open(t),t.setCenter(o),M(n.coords.latitude),I(n.coords.longitude);const g=l(i,"place");S(g,{lat:n.coords.latitude,lng:n.coords.longitude,number:C})},function(){R(!0,e,t.getCenter())}):R(!1,e,t.getCenter())}function R(t,e){infoWindow.setPosition(e),infoWindow.setContent(t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),infoWindow.open(ce)}window.initMap=D;const[y,Q]=s.exports.useState([]);s.exports.useEffect(()=>{(async()=>{const e=l(i,"client");f(e,n=>{Q(n.docs.map(o=>({...o.data(),id:o.id})))})})()},[]);const _=()=>r.map((t,e)=>t.toDriver===d?a("div",{children:[a("h4",{children:[" Client Name: ",t.name," "]}),a("h4",{children:[" number: ",t.number]}),a("h4",{children:[" From : ",t.To," "]}),a("h4",{children:[" To : ",t.pickup," "]}),a("h4",{children:[" Distance : ",t.distance]}),a("h4",{children:[" Avg Duration : ",t.duration]}),a("h4",{children:[" Ride Status : ",t.status]}),a("h4",{children:[" Driver : ",t.toDriver," "]}),a("h4",{onClick:()=>{U(t.id)},children:[" ","id : ",t.id," "]})]},e):null),O=()=>y.map((t,e)=>{if(d===J)return a("div",{className:"button-css",children:[a("h4",{children:[" Client Status : ",t.client]}),a("button",{className:"button",onClick:()=>{const n=u(i,"client",t.id);x(n,{client:"client pickedup"})},children:[" ","client pickup"]})]},e)});function Y(){return(()=>W.map((e,n)=>{const o=u(i,"driver",e.id);x(o,{statusDispatch:"accepted"})}))()}function q(){const t=l(i,"place");S(t,{lat:m,lng:h,number:d})}function H(){return(()=>setInterval(()=>{P.map((e,n)=>{if(e.id){const o=u(i,"place",e.id);x(o,{lat:m,lng:h}),console.log(e.id)}})},1e3))()}console.log(m,h);const[J,V]=s.exports.useState(),[X,Z]=s.exports.useState();function $(){return(()=>r.map((e,n)=>{V(d),Z(e.client);const o=u(i,"drivers",e.id);x(o,{status:"accepted"});const ae=l(i,"client");X===e.client&&S(ae,{client:"driver underway",number:Number(d),clientId:e.client})}))()}function ee(){return(()=>r.map((e,n)=>{T(u(i,"drivers",j)),v(0)}))()}function te(){return(()=>y.map((e,n)=>{T(u(i,"client",e.id)),v(0)}))()}function ne(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{b.onAuthStateChanged(n=>{n&&e(n.uid)})},[]),t}ne();function oe(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{b.onAuthStateChanged(n=>{n?A.collection("rider").doc(n.uid).get().then(o=>{e(o.data().FullName),v(o.data().Number)}):e(null)})},[]),t}const w=oe();function se(){const[t,e]=s.exports.useState(null);return s.exports.useEffect(()=>{b.onAuthStateChanged(n=>{n?A.collection("manager").doc(n.uid).get().then(o=>{e(o.data().FullName)}):e(null)})},[]),t}const E=se();return N?N&&E||d||w?a("div",{className:"",children:[c(ie,{riders:w,manager:E}),a("div",{className:"whole-driver-div",children:[a("div",{className:"driver-view",children:[a("button",{id:"button",className:"map-btn button",onClick:()=>{setInterval(()=>{D(),z("block")},3e4),setTimeout(()=>{q()},9e3)},children:[" ","Open For Ride"," "]}),a("button",{className:"button",onClick:()=>{setInterval(()=>{H()},9e3)},children:[" ","Send to Dispatch"," "]}),a("p",{children:[" ",m," , ",h,"  "]}),c(_,{})," ",a("button",{className:"button",onClick:()=>{$(),Y()},children:[" ","Accept Ride"," "]}),a("button",{className:"button",onClick:()=>{ee(),te()},children:[" ","Remove Ride"," "]}),c(O,{})]}),c("div",{className:"map-view-driver",children:c(L,{id:"map",className:"",zoom:12,center:K,mapContainerClassName:"admin-map driver-map"})})]})]}):null:c("div",{children:" loading .... "})}export{me as State,he as default};
