import{r as o,j as i,a,T as m,b as f,A as r,K as u,d as c,c as S,f as y,G as E}from"./index-adb3a795.js";import{u as te,N as ne,G as oe}from"./esm-f88a55dc.js";function pe({lat:l,lon:h}){return a("p",{children:[" ",l," ",h," "]})}function me(){const[l,h]=o.exports.useState([]);o.exports.useState(""),o.exports.useState("");const[g,A]=o.exports.useState(""),[x,T]=o.exports.useState("");o.exports.useState([]);const[k,se]=o.exports.useState([]),[G,ae]=o.exports.useState(""),[d,v]=o.exports.useState(null),[ce,M]=o.exports.useState([]),[L,I]=o.exports.useState(""),[ie,W]=o.exports.useState("none");o.exports.useState();const[b,F]=o.exports.useState([]);o.exports.useEffect(()=>{(async()=>{const e=m(c,"place");f(e,n=>{F(n.docs.map(s=>({...s.data(),id:s.id})))})})()},[]),o.exports.useEffect(()=>{(async()=>{const e=m(c,"drivers");f(e,n=>{h(n.docs.map(s=>({...s.data(),id:s.id})))})})()},[]),o.exports.useEffect(()=>{(async()=>{const e=m(c,"rider");f(e,n=>{M(n.docs.map(s=>({...s.data(),id:s.id})))})})()},[]);const{isLoaded:C}=te({googleMapsApiKey:"AIzaSyDWW3NiTjdfwhcLPFux_oOEhfped_Qs3EA",libraries:["places"]}),U={lat:5.839398,lng:-55.199089};function N(){var t,e;t=new google.maps.Map(document.getElementById("map"),{center:{lat:5.839398,lng:-55.199089},zoom:18}),e=new google.maps.InfoWindow,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var s={lat:n.coords.latitude,lng:n.coords.longitude};e.setPosition(s),e.setContent(G),e.open(t),t.setCenter(s),A(n.coords.latitude),T(n.coords.longitude),b.map((p,le)=>{const $=r(c,"place","wNY5vHqvIZAsDKAGvYie"),ee={lat:n.coords.latitude,lng:n.coords.longitude};u($,ee),console.log(p.id)})},function(){D(!0,e,t.getCenter())}):D(!1,e,t.getCenter())}function D(t,e){infoWindow.setPosition(e),infoWindow.setContent(t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),infoWindow.open(Map)}window.initMap=N;const[j,B]=o.exports.useState([]);o.exports.useEffect(()=>{(async()=>{const e=m(c,"client");f(e,n=>{B(n.docs.map(s=>({...s.data(),id:s.id})))})})()},[]);const K=()=>l.map((t,e)=>(console.log(t.ndriver,d),t.ndriver===d?a("div",{children:[a("h4",{children:[" Client Name: ",t.name," "]}),a("h4",{children:[" number: ",t.number]}),a("h4",{children:[" From : ",t.start," "]}),a("h4",{children:[" To : ",t.end," "]}),a("h4",{children:[" Distance : ",t.distance]}),a("h4",{children:[" Avg Duration : ",t.duration]}),a("h4",{children:[" Ride Status : ",t.status]}),a("h4",{children:[" Driver : ",t.ndriver," "]}),a("h4",{onClick:()=>{I(t.id)},children:[" ","id : ",t.id," "]})]},e):null)),P=()=>l.map((t,e)=>{if(d===O)return i("div",{className:"button-css",children:a("button",{className:"button",onClick:()=>{const n=r(c,"drivers",t.id);u(n,{status:"client pickedup"})},children:[" ","client pickup"]})},e)});function z(){return(()=>k.map((e,n)=>{const s=r(c,"driver",e.id);u(s,{status:"accepted"})}))()}function Y(){return(()=>{b.map((e,n)=>{const s=r(c,"place",e.id);u(s,{lat:g,lng:x}),console.log(e.id)})})()}console.log(g,x);const[O,_]=o.exports.useState(),[re,q]=o.exports.useState();function H(){return(()=>l.map((e,n)=>{_(d),q(e.client);const s=r(c,"drivers",e.id);u(s,{status:"accepted"})}))()}function Q(){return(()=>l.map((e,n)=>{E(r(c,"drivers",L)),v(0)}))()}function Z(){return(()=>j.map((e,n)=>{E(r(c,"client",e.id)),v(0)}))()}function J(){const[t,e]=o.exports.useState(null);return o.exports.useEffect(()=>{S.onAuthStateChanged(n=>{n&&e(n.uid)})},[]),t}J();function V(){const[t,e]=o.exports.useState(null);return o.exports.useEffect(()=>{S.onAuthStateChanged(n=>{n?y.collection("rider").doc(n.uid).get().then(s=>{e(s.data().FullName),v(s.data().Number)}):e(null)})},[]),t}const R=V();function X(){const[t,e]=o.exports.useState(null);return o.exports.useEffect(()=>{S.onAuthStateChanged(n=>{n?y.collection("manager").doc(n.uid).get().then(s=>{e(s.data().FullName)}):e(null)})},[]),t}const w=X();return C?C&&w||d||R?a("div",{className:"",children:[i(ne,{riders:R,manager:w}),a("div",{className:"whole-driver-div",children:[a("div",{className:"driver-view",children:[a("button",{id:"button",className:"map-btn button",onClick:()=>{setInterval(()=>{N(),W("block")},3e4),setTimeout(()=>{},9e3)},children:[" ","Open For Ride"," "]}),a("button",{className:"button",onClick:()=>{setInterval(()=>{Y()},9e3)},children:[" ","Send to Dispatch"," "]}),a("p",{children:[" ",g," , ",x,"  "]}),i(K,{})," ",a("button",{className:"button",onClick:()=>{H(),z()},children:[" ","Accept Ride"," "]}),a("button",{className:"button",onClick:()=>{Q(),Z()},children:[" ","Remove Ride"," "]}),i(P,{})]}),i("div",{className:"map-view-driver",children:i(oe,{id:"map",className:"",zoom:12,center:U,mapContainerClassName:"admin-map driver-map"})})]})]}):null:i("div",{children:" loading .... "})}export{pe as State,me as default};
